suite: test prometheus rules
templates:
  - prometheus-rules-sla.yaml
  - prometheus-rules-langgraph.yaml
tests:
  - it: should not create PrometheusRule when disabled
    set:
      kube-prometheus-stack.enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should create PrometheusRule when enabled
    set:
      kube-prometheus-stack.enabled: true
    template: prometheus-rules-sla.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: PrometheusRule
      - equal:
          path: metadata.name
          value: RELEASE-NAME-mcp-server-langgraph-sla-alerts

  - it: should include prometheus label
    set:
      kube-prometheus-stack.enabled: true
    template: prometheus-rules-langgraph.yaml
    asserts:
      - equal:
          path: metadata.labels.prometheus
          value: kube-prometheus

  - it: should have spec from rules file
    set:
      kube-prometheus-stack.enabled: true
    template: prometheus-rules-langgraph.yaml
    asserts:
      - isNotEmpty:
          path: spec

  - it: should validate hyphenated key access
    set:
      kube-prometheus-stack:
        enabled: true
        someOtherField: test
    template: prometheus-rules-sla.yaml
    asserts:
      - isKind:
          of: PrometheusRule
    documentIndex: 0
