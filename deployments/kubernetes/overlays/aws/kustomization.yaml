apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: mcp-server-langgraph

# Base resources
resources:
  - ../../base
  - external-secrets.yaml

# AWS-specific labels
commonLabels:
  cloud.provider: aws
  cloud.platform: aws_eks
  managed-by: kustomize

# AWS-specific annotations
commonAnnotations:
  cloud.provider: aws
  deployment.platform: eks

# Patches for AWS EKS integration
patchesStrategicMerge:
  - serviceaccount-patch.yaml
  - deployment-patch.yaml

# ConfigMap for OpenTelemetry with AWS exporters
configMapGenerator:
  - name: otel-collector-config
    behavior: replace
    files:
      - otel-collector.yaml=otel-collector-config.yaml

# Images - override if using ECR
# NOTE: This is a template configuration for AWS deployments
# Before deploying, replace ACCOUNT_ID with your AWS account ID and REGION with your AWS region
# Example: 123456789012.dkr.ecr.us-east-1.amazonaws.com/mcp-server-langgraph
# Or comment out this section to use the default GitHub Container Registry image
images:
  - name: ghcr.io/vishnu2kmohan/mcp-server-langgraph
    newName: ACCOUNT_ID.dkr.ecr.REGION.amazonaws.com/mcp-server-langgraph
    newTag: latest

# Replica count adjustments (override in environment-specific overlays)
replicas:
  - name: mcp-server-langgraph
    count: 3

# Resource quotas and limits
generatorOptions:
  disableNameSuffixHash: false

# Variables that can be set via kustomize edit
vars:
  - name: AWS_REGION
    objref:
      kind: ConfigMap
      name: aws-config
      apiVersion: v1
    fieldref:
      fieldpath: data.region
