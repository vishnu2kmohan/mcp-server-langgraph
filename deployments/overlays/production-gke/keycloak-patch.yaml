apiVersion: apps/v1
kind: Deployment
metadata:
  name: keycloak
spec:
  template:
    spec:
      # Pod-level security context
      securityContext:
        runAsNonRoot: true
        runAsUser: 10000
        runAsGroup: 10000
        fsGroup: 10000
        seccompProfile:
          type: RuntimeDefault

      # Init containers
      initContainers:
      - name: wait-for-postgres
        imagePullPolicy: Always
        resources:
          requests:
            cpu: 50m
            memory: 64Mi
            ephemeral-storage: 500Mi
          limits:
            cpu: 100m
            memory: 128Mi
            ephemeral-storage: 1Gi
        securityContext:
          runAsUser: 10000
          runAsGroup: 10000

      containers:
      - name: keycloak
        imagePullPolicy: Always
        resources:
          requests:
            cpu: 500m
            memory: 1Gi
            ephemeral-storage: 1Gi
          limits:
            cpu: 2000m
            memory: 2Gi
            ephemeral-storage: 2Gi
        securityContext:
          runAsUser: 10000
          runAsGroup: 10000
