---
# Transform redis-session service to ExternalName service for Memorystore Redis
#
# Replaces the base ClusterIP service (which points to in-cluster redis-session
# deployment) with an ExternalName service that uses Cloud DNS for robust failover.
#
# IMPORTANT: Configure Cloud DNS record before deploying:
#   redis-session-preview.internal -> Your Memorystore Redis IP
#
# See: DNS_SETUP.md for Cloud DNS configuration instructions
#
# Using Cloud DNS instead of hard-coded IPs enables:
# - Automatic failover (update DNS, no manifest changes needed)
# - Environment portability
# - Centralized IP management
apiVersion: v1
# trivy:ignore:AVD-KSV-0108
kind: Service
metadata:
  name: redis-session
  annotations:
    description: "ExternalName service for Memorystore Redis via Cloud DNS"
spec:
  type: ExternalName
  externalName: redis-session-preview.preview.internal
  # Remove selector for ExternalName service
  selector: null
  # ExternalName services don't support ports, but we keep metadata for reference
  # Using standard Redis port (6379) for documentation/OPA compliance
  # Actual Memorystore connection uses port configured in REDIS_URL environment variable
  ports:
  - name: memorystore-redis
    port: 6379
    protocol: TCP
