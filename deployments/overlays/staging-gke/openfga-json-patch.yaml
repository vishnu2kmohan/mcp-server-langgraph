# Set OpenFGA ServiceAccount for Workload Identity
- op: replace
  path: /spec/template/spec/serviceAccountName
  value: staging-openfga

# Remove init container - direct Cloud SQL connection
- op: remove
  path: /spec/template/spec/initContainers/0

# Add database password environment variable
- op: add
  path: /spec/template/spec/containers/0/env/-
  value:
    name: OPENFGA_DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: mcp-staging-secrets
        key: openfga-db-password

# Update connection string to use direct Cloud SQL private IP with password from secret
- op: replace
  path: /spec/template/spec/containers/0/env/1
  value:
    name: OPENFGA_DATASTORE_URI
    valueFrom:
      secretKeyRef:
        name: mcp-staging-secrets
        key: openfga-datastore-uri
