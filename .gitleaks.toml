# Gitleaks Configuration
#
# Prevents false positives from documentation, examples, tests, and dependencies
# while still detecting real secrets in source code.
#
# See: https://github.com/gitleaks/gitleaks#configuration

title = "MCP Server LangGraph - Gitleaks Configuration"

# Allowlist: Paths and patterns that should NOT be scanned for secrets
[allowlist]
  description = "Allowlist for documentation examples, test data, and dependencies"

  # Exclude documentation directories with code examples
  paths = [
    # Test environment configuration (test-only credentials, safe to commit)
    # Contains JWT_SECRET_KEY, KEYCLOAK_CLIENT_SECRET with "test" indicators
    '''\.env\.test''',

    # Documentation examples (NOT real secrets - just showing what NOT to do)
    '''\.openai/''',
    '''docs/''',
    '''\.mintlify/''',

    # Dependency directories (third-party code we don't control)
    '''\.venv/''',
    '''venv/''',
    '''\.venv-test/''',
    '''node_modules/''',
    '''\.tox/''',
    '''__pycache__/''',
    '''\.pytest_cache/''',

    # Generated client code (auto-generated by OpenAPI Generator)
    '''clients/python/''',
    '''clients/typescript/''',
    '''clients/go/''',

    # Test fixtures and test data
    '''tests/fixtures/''',
    '''tests/testdata/''',
    '''test_.*\.tmp''',

    # Build artifacts
    '''dist/''',
    '''build/''',
    '''\.egg-info/''',
    '''wheels/''',

    # Helm generated templates (contain Go templating, not real values)
    '''deployments/helm/.*/templates/''',

    # Lock files (contain package hashes that trigger false positives)
    '''poetry\.lock''',
    '''Pipfile\.lock''',
    '''package-lock\.json''',
    '''yarn\.lock''',
    '''uv\.lock''',

    # Git metadata
    '''\.git/''',
  ]

  # Regex patterns to allowlist
  regexes = [
    # Example/placeholder tokens in documentation
    '''sk-[a-zA-Z0-9]{48}.*example''',
    '''sk-[a-zA-Z0-9]{48}.*placeholder''',
    '''sk-[a-zA-Z0-9]{48}.*test''',
    '''sk-[a-zA-Z0-9]{48}.*demo''',

    # Comments showing what NOT to do
    '''# ‚ùå BAD''',
    '''# DO NOT''',
    '''# Example:''',
    '''# WRONG:''',

    # Test/mock values
    '''test[_-]?secret''',
    '''mock[_-]?api[_-]?key''',
    '''fake[_-]?password''',
    '''example[_-]?token''',
  ]

  # Specific commits to ignore (if needed)
  commits = []

  # Stop words - if these appear near a secret, it's likely a false positive
  stopwords = [
    "example",
    "test",
    "mock",
    "fake",
    "placeholder",
    "demo",
    "sample",
  ]


# Custom rules can be added here
[[rules]]
  id = "generic-api-key-with-context"
  description = "Generic API key pattern but exclude documentation"
  regex = '''(?i)(api[_-]?key|apikey|api[_-]?token)['\"]?\s*[=:]\s*['\"]?([a-zA-Z0-9_\-]{20,})'''
  tags = ["api", "key"]

  # Additional entropy check to reduce false positives
  [rules.allowlist]
    description = "Ignore keys in documentation and examples"
    regexes = [
      '''(?i)(example|test|demo|mock|placeholder|sample)''',
    ]


# Report configuration
[extend]
  # Use default gitleaks rules in addition to custom rules
  useDefault = true


# Output configuration (for CI/CD)
# Uncomment to write results to a file
# [output]
#   path = "gitleaks-report.json"
#   format = "json"
