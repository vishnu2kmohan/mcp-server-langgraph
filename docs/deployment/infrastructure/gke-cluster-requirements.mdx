---
title: GKE Cluster Requirements for CI/CD
description: 'Prerequisites and setup guide for GKE clusters required by CI/CD deployment workflows'
icon: 'google'
seoTitle: "GKE Cluster Requirements - CI/CD Infrastructure Setup"
seoDescription: "Learn how to create and configure GKE Autopilot clusters for staging and production CI/CD deployments"
keywords: ["GKE", "Google Kubernetes Engine", "CI/CD", "infrastructure", "Terraform", "cluster setup", "Autopilot"]
contentType: "how-to"
---

# GKE Cluster Requirements for CI/CD

## Overview

The CI/CD pipeline requires GKE clusters to exist before deployment workflows can succeed. This document outlines the required clusters and how to create them.

## Required Clusters

### Staging Cluster

**Name:** `staging-mcp-server-langgraph-gke`
**Location:** `us-central1`
**Project:** `vishnu-sandbox-20250310`
**Type:** GKE Autopilot (recommended) or Standard

**Creation via Terraform:**
```bash
cd terraform/environments/gcp-staging
terraform init
terraform plan
terraform apply
```
**Manual Creation:**
```bash
gcloud container clusters create-auto staging-mcp-server-langgraph-gke \
  --region=us-central1 \
  --project=vishnu-sandbox-20250310 \
  --release-channel=regular \
  --enable-master-authorized-networks \
  --network=default \
  --subnetwork=default
```

### Production Cluster

**Name:** `production-mcp-server-langgraph-gke`
**Location:** `us-central1`
**Project:** `vishnu-sandbox-20250310`
**Type:** GKE Autopilot

**Creation via Terraform:**
```bash
cd terraform/environments/gcp-prod
terraform init
terraform plan
terraform apply
```
## CI/CD Workflow Dependencies

### deploy-preview-gke.yaml

This workflow requires:
- ✅ GKE cluster: `staging-mcp-server-langgraph-gke` in `us-central1`
- ✅ Service account: `github-actions-staging@vishnu-sandbox-20250310.iam.gserviceaccount.com`
- ✅ Artifact Registry: `mcp-staging` repository
- ✅ GitHub variable: `ENABLE_STAGING_AUTODEPLOY=true`

**Workflow Trigger:**
- Push to `main` branch (when `ENABLE_STAGING_AUTODEPLOY=true`)
- Manual dispatch

**Current Status:**
- ❌ Cluster not found error: The cluster `staging-mcp-server-langgraph-gke` does not exist in the specified location.

**Resolution:**
Create the cluster using one of the methods above, then re-run the workflow.

### deploy-production-gke.yaml

This workflow requires:
- ⚠️  GKE cluster: `production-mcp-server-langgraph-gke` in `us-central1`
- ✅ Service account: `github-actions-production@vishnu-sandbox-20250310.iam.gserviceaccount.com`
- ✅ Artifact Registry: `mcp-production` repository

**Workflow Trigger:**
- Manual dispatch (requires approval)
- Release tags

## Verification

After creating clusters, verify they're accessible:

```bash
# Verify staging cluster
gcloud container clusters describe staging-mcp-server-langgraph-gke \
  --region=us-central1 \
  --project=vishnu-sandbox-20250310

# Verify production cluster
gcloud container clusters describe production-mcp-server-langgraph-gke \
  --region=us-central1 \
  --project=vishnu-sandbox-20250310

# Test GitHub Actions service account access
gcloud container clusters get-credentials staging-mcp-server-langgraph-gke \
  --region=us-central1 \
  --project=vishnu-sandbox-20250310

kubectl cluster-info
```

## Terraform Module Reference

The GKE Autopilot module is located at:
`terraform/modules/gke-autopilot/`

**Features:**
- Autopilot mode (Google-managed nodes)
- VPC-native networking
- Workload Identity Federation support
- Master authorized networks
- Binary authorization (optional)
- Backup agent integration
- Config Connector support

**Recent Fixes:**
- ✅ Duplicate lifecycle blocks merged (commit b6ac198)
- ✅ Variable validation moved to lifecycle preconditions
- ✅ Terraform validation added to pre-commit hooks

## Troubleshooting

### Error: Cluster not found

**Symptom:**
```yaml
Error: NOT_FOUND: projects/vishnu-sandbox-20250310/locations/us-central1/clusters/staging-mcp-server-langgraph-gke not found
```

**Solution:**
The cluster doesn't exist. Create it using the methods above.

### Error: Permission denied

**Symptom:**
```yaml
Error: github-actions-staging does not have permission to access cluster
```

**Solution:**
Verify the service account has the `container.developer` role:
```bash
gcloud projects get-iam-policy vishnu-sandbox-20250310 \
  --flatten="bindings[].members" \
  --filter="bindings.members:github-actions-staging*"
```
### Error: Artifact Registry repository not found

**Solution:**
Create the Artifact Registry repositories:
```bash
# Staging
gcloud artifacts repositories create mcp-staging \
  --repository-format=docker \
  --location=us-central1 \
  --project=vishnu-sandbox-20250310

# Production
gcloud artifacts repositories create mcp-production \
  --repository-format=docker \
  --location=us-central1 \
  --project=vishnu-sandbox-20250310
```

## Auto-Deploy Configuration

The deployment workflows check repository variables to determine if auto-deploy is enabled:

```bash
# Enable staging auto-deploy
gh variable set ENABLE_STAGING_AUTODEPLOY --body "true"

# Enable dev auto-deploy
gh variable set ENABLE_DEV_AUTODEPLOY --body "true"

# Verify
gh variable list
```

## Related Documentation

- [GKE Autopilot Module](https://github.com/vishnu2kmohan/mcp-server-langgraph/blob/main/terraform/modules/gke-autopilot/README.md)
- [CI/CD Overview](/ci-cd/overview)
- [GitHub Actions WIF Setup](https://github.com/vishnu2kmohan/mcp-server-langgraph/blob/main/terraform/modules/github-actions-wif/README.md)
- [CI/CD Failure Analysis](https://github.com/vishnu2kmohan/mcp-server-langgraph/blob/main/workflow-analysis.md)

## Last Updated

2025-11-04 (Commit: b6ac198)

**Status:**
- Terraform module: ✅ Fixed and validated
- Service accounts: ✅ Created and configured
- Auto-deploy variables: ✅ Set
- GKE clusters: ❌ Need to be created
