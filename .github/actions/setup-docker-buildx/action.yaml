name: 'Setup Docker Buildx'
description: 'Set up Docker Buildx (with optional QEMU for multiplatform builds)'
author: 'Vishnu Mohan <vmohan@emergence.ai>'

inputs:
  enable-qemu:
    description: 'Enable QEMU for multiplatform builds (linux/amd64, linux/arm64)'
    required: false
    default: 'false'
  buildx-version:
    description: 'Docker Buildx version (e.g., v0.11.2, latest)'
    required: false
    default: 'latest'
  driver-opts:
    description: 'Buildx driver options (e.g., network=host)'
    required: false
    default: ''
  config-inline:
    description: 'Inline Buildx configuration'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: Set up QEMU
      if: inputs.enable-qemu == 'true'
      uses: docker/setup-qemu-action@v3.7.0

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3.11.1
      with:
        version: ${{ inputs.buildx-version }}
        driver-opts: ${{ inputs.driver-opts }}
        config-inline: ${{ inputs.config-inline }}

branding:
  icon: 'package'
  color: 'blue'
