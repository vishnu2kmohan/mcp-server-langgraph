# Development override for docker-compose.yml
# Usage: docker compose -f docker-compose.yml -f docker/docker-compose.dev.yml up
#
# This file only overrides development-specific settings.
# The base agent service is defined in docker-compose.yml

services:
  agent:
    # Override build target for dev dependencies
    build:
      target: build-base  # Use build-base stage for dev dependencies

    # Add hot reload
    command: python -m uvicorn mcp_server_langgraph.mcp.server_streamable:app --host 0.0.0.0 --port 8000 --reload

    # Mount source code for hot reload
    volumes:
      - ../src:/app/src
      - ../config:/app/config
      - /app/src/__pycache__
      - /app/.pytest_cache

    # Override environment for development
    environment:
      - ENVIRONMENT=development
      - LOG_LEVEL=DEBUG
      - ENABLE_CONSOLE_EXPORT=true
      - LANGSMITH_TRACING=false  # Disable by default in dev to avoid costs

    # Add debugpy port
    ports:
      - "8000:8000"
      - "5678:5678"  # debugpy port

  # Use in-memory storage for faster startup in development
  openfga:
    command: run --datastore-engine=memory
    environment:
      - OPENFGA_DATASTORE_ENGINE=memory
      - OPENFGA_LOG_LEVEL=debug
    depends_on: []  # Remove postgres dependency for faster startup
