# Skaffold configuration for local Kubernetes development
apiVersion: skaffold/v4beta7
kind: Config
metadata:
  name: langgraph-agent

build:
  artifacts:
  - image: langgraph-agent
    docker:
      dockerfile: Dockerfile
    sync:
      manual:
      - src: "**/*.py"
        dest: /app

deploy:
  helm:
    releases:
    - name: langgraph-agent
      chartPath: helm/langgraph-agent
      namespace: langgraph-agent
      createNamespace: true
      valuesFiles:
      - helm/langgraph-agent/values.yaml
      setValues:
        image.pullPolicy: IfNotPresent
        replicaCount: 1
        resources.requests.cpu: 100m
        resources.requests.memory: 256Mi
        resources.limits.cpu: 500m
        resources.limits.memory: 512Mi
      setValueTemplates:
        image.repository: langgraph-agent
        image.tag: "{{ .IMAGE_TAG }}"

portForward:
- resourceType: service
  resourceName: langgraph-agent
  namespace: langgraph-agent
  port: 80
  localPort: 8000

profiles:
- name: dev
  activation:
  - command: dev
  deploy:
    kubeContext: docker-desktop

- name: production
  build:
    tagPolicy:
      gitCommit: {}
  deploy:
    helm:
      releases:
      - name: langgraph-agent
        chartPath: helm/langgraph-agent
        namespace: langgraph-agent
        setValues:
          autoscaling.enabled: true
